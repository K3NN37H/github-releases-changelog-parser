import S from"./_snowpack/pkg/react-markdown.js";import e,{useMemo as g,useState as o}from"./_snowpack/pkg/react.js";import{Octokit as j}from"./_snowpack/pkg/@octokit/core.js";import{throttling as F}from"./_snowpack/pkg/@octokit/plugin-throttling.js";import{paginateRest as L}from"./_snowpack/pkg/@octokit/plugin-paginate-rest.js";const O=j.plugin(F,L),$=new O({throttle:{onRateLimit:(r,a,n)=>{if(n.log.warn(`Rate limit hit ${a.url}`),a.request.retryCount===0)return n.log.info(`Retry after ${r} seconds`),!0},onAbuseLimit:(r,a,n)=>{n.log.warn(`Abuse limit hit ${a.url}`)}}}),x=/breaking/i,D="[-\\w.]+/[-\\w.]+";export default function N(){const[r,a]=o(""),[n,u]=o(null),[l,d]=o(100),[i,f]=o(""),[h,P]=o(10),[k,s]=e.useState("init"),E=t=>{if(t.preventDefault(),t.stopPropagation(),console.log("sending"),!r)return;const y=async()=>{let R=1;const[_,v]=r.split("/"),p=await $.paginate("GET /repos/{owner}/{repo}/releases",{owner:_,repo:v,per_page:l},(c,m)=>((c.data.find(({name:A,tag_name:C})=>i&&(C===i||A===i))||R++>=h)&&m(),c.data));console.log("Response",p),s("success"),u(p)};s("loading"),y()},w=g(()=>n?n.filter(t=>x.test(t.body||"")).map(t=>e.createElement("li",{key:`toc-${t.tag_name}`},e.createElement("a",{href:`#${t.tag_name}`},t.tag_name))):null,[n]),b=g(()=>n?n.map(t=>e.createElement("div",{key:t.tag_name},e.createElement("h1",{id:t.tag_name},t.tag_name),e.createElement(S,{children:t.body||""}))):null,[n]);return e.createElement(e.Fragment,null,e.createElement("form",{onSubmit:E},e.createElement("label",{htmlFor:"repo"},"Owner/repo"),e.createElement("input",{type:"text",id:"repo",placeholder:"owner/repo",pattern:D,required:!0,onChange:t=>a(t.target.value)}),e.createElement("label",{htmlFor:"releases"},"Number of releases per page"),e.createElement("input",{type:"range",id:"releases",min:1,max:100,value:l,onChange:t=>d(parseInt(t.target.value,10))}),l,e.createElement("label",{htmlFor:"stopversion"},"Oldest version to stop at"),e.createElement("input",{type:"text",id:"stopversion",onChange:t=>f(t.target.value)}),e.createElement("input",{type:"submit"})),e.createElement("div",{className:"toc"},e.createElement("h2",null,"Releases with potentially breaking changes"),e.createElement("ul",null,w)),k==="loading"&&e.createElement("span",null,"Loading..."),b)}
